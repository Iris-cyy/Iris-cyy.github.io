<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Projects,Java," />




  


  <link rel="alternate" href="/atom.xml" title="花落知多少" type="application/atom+xml" />






<meta name="description" content="MUA是ZJU编程语言原理（Principle of Programming Language）课程中用到的编程语言。本项目要做的工作是使用JAVA语言完成一个MUA语言的解释器，通过命令行与用户进行交互，解析并运行用户输入的代码。 本项目仅能够针对课程的测试点实现基本要求，但还有很多部分需要完善（例如在遇见具有语法错误的代码时，不能进行解析，而是整个程序会报错，函数的参数数量有限制，save和l">
<meta property="og:type" content="article">
<meta property="og:title" content="MUA Interpreter">
<meta property="og:url" content="https://iris-cyy.github.io/Projects/2020-02-01/mua_interpreter/index.html">
<meta property="og:site_name" content="花落知多少">
<meta property="og:description" content="MUA是ZJU编程语言原理（Principle of Programming Language）课程中用到的编程语言。本项目要做的工作是使用JAVA语言完成一个MUA语言的解释器，通过命令行与用户进行交互，解析并运行用户输入的代码。 本项目仅能够针对课程的测试点实现基本要求，但还有很多部分需要完善（例如在遇见具有语法错误的代码时，不能进行解析，而是整个程序会报错，函数的参数数量有限制，save和l">
<meta property="article:published_time" content="2020-02-01T08:31:20.000Z">
<meta property="article:modified_time" content="2020-02-03T03:55:39.757Z">
<meta property="article:author" content="Irisssy">
<meta property="article:tag" content="Projects">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: 'AWI44TKCWF',
      apiKey: '47152bafbd084f0e2f14756524feff94',
      indexName: 'blogIndex_NAME',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://iris-cyy.github.io/Projects/2020-02-01/mua_interpreter/"/>





  <title>MUA Interpreter | 花落知多少</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?98ba9ea0a4c9adce8b273e137e8bcf3f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">花落知多少</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Nice to meet you :)</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://iris-cyy.github.io/Projects/2020-02-01/mua_interpreter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Irisssy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花落知多少">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">MUA Interpreter</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-01T16:31:20+08:00">
                2020-02-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Projects/" itemprop="url" rel="index">
                    <span itemprop="name">Projects</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/Projects/2020-02-01/mua_interpreter/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/Projects/2020-02-01/mua_interpreter/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/Projects/2020-02-01/mua_interpreter/" class="leancloud_visitors" data-flag-title="MUA Interpreter">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>MUA是ZJU编程语言原理（Principle of Programming Language）课程中用到的编程语言。本项目要做的工作是使用JAVA语言完成一个MUA语言的解释器，通过命令行与用户进行交互，解析并运行用户输入的代码。</p>
<p>本项目仅能够针对课程的测试点实现基本要求，但还有很多部分需要完善（例如在遇见具有语法错误的代码时，不能进行解析，而是整个程序会报错，函数的参数数量有限制，save和load的实际操作，etc.），以及有很多部分可以优化（例如各class的构造，其实有一些可以去掉），会在后续进行更新。</p>
<p>以下是对于该语言基本语法以及解析器实现方式的说明。</p>
<h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2><p>首先要注意的是，MUA是一个解释型语言，但是和Python不同，MUA语言中，空格、tab、换行等不能标记一个语句的结束，或者分支情况。</p>
<h3 id="基本数据类型value"><a href="#基本数据类型value" class="headerlink" title="基本数据类型value"></a>基本数据类型value</h3><p>数字number，字word，表list，布尔bool</p>
<ul>
<li>数字的字面量以[0~9]或’-‘开头，不区分整数，浮点数</li>
<li>字的字面量以双引号<code>&quot;</code> 开头，不含空格，采用Unicode编码。在 <code>&quot;</code> 后的任何内容，直到空格（包括空格、tab和回车）为止的字符（不含空格），都是这个字的一部分，包括其中可能有的 <code>&quot;</code> 和 <code>[]</code> 等符号</li>
<li>表的字面量量以方括号 <code>[]</code> 包含，其中的元素以空格分隔；元素可是任意类型；元素类型可不一致；<ul>
<li>表的第一个元素和<code>[</code>之间，以及最后一个元素和<code>]</code>之间不需要由空格分隔</li>
<li>表中的字不需要<code>&quot;</code>引导</li>
<li>这是一个有三层表的字面量的例子：<code>[a [b [c d] e]]</code></li>
</ul>
</li>
<li>布尔量只有两个值： <code>true</code> 和 <code>false</code></li>
<li>数字和布尔量在计算时可以被看作是字的特殊形式，即在字面量和变量中的字，当其中的内容是数字或布尔量时，总是可以根据需要自动被转换成数字或布尔量</li>
</ul>
<h3 id="名字name"><a href="#名字name" class="headerlink" title="名字name"></a>名字name</h3><p>一个以字母开头，只含有字母和数字及下划线的字，可以用做名字，名字区分大小写。</p>
<p>函数名和变量名都算是name</p>
<p>word只有在作为name使用时需要加<code>&quot;</code>（例如在<code>make</code>、<code>save</code>、<code>print</code>、<code>isname</code>以及字表操作等等），其他时候（比如在list中，调用函数时，print里面的输出等等）不需要用<code>&quot;</code>。</p>
<h3 id="基本操作operation"><a href="#基本操作operation" class="headerlink" title="基本操作operation"></a>基本操作operation</h3><p>基本形式：操作名 参数</p>
<p>操作名是一个名字，与参数间以空格分隔。参数可以有多个，多个参数间以空格分隔。每个操作所需的参数数量是确定的，所以不需要括号或语句结束符号。有的操作有返回值，有的没有。</p>
<p>一个程序就是操作的序列。</p>
<p>基本操作有：</p>
<ul>
<li><p><code>//</code> ：注释，从//到行末均为注释</p>
</li>
<li><p><code>make &lt;name&gt; &lt;value&gt;</code> ： 将value绑定到name上，绑定后的名字位于命名空间。此文档中的基本操作的名字不能重新命名</p>
<blockquote>
<p>make “b “a  –&gt;  thing “b == a, thing :b == value of a</p>
</blockquote>
</li>
<li><p><code>thing &lt;name&gt;</code> ：返回word所绑定的值</p>
</li>
<li><p><code>:&lt;name&gt;</code> ：与thing相同</p>
<blockquote>
<p>:a  ==  thing “a</p>
</blockquote>
</li>
<li><p><code>erase &lt;name&gt;</code> ：清除word所绑定的值</p>
</li>
<li><p><code>isname &lt;word&gt;</code> ：返回word是否是一个名字，true/false</p>
<blockquote>
<p>isname “a</p>
</blockquote>
</li>
<li><p><code>print &lt;value&gt;</code> ：输出value</p>
<blockquote>
<p>print “a  –&gt;  a<br>print 1  –&gt;  1<br>print true  –&gt;  true<br>print :a  –&gt;  6 （如果前面make “a 6）<br>print [a b c]  –&gt;  a b c</p>
</blockquote>
</li>
<li><p><code>read</code> ：返回一个从标准输入读取的数字或字</p>
</li>
<li><p>运算符operator</p>
<ul>
<li><code>add</code> , <code>sub</code>, <code>mul</code> , <code>div</code> , <code>mod</code> ： <code>&lt;operator&gt; &lt;number&gt; &lt;number&gt;</code></li>
<li><code>eq</code> , <code>gt</code> , <code>lt</code> ： <code>&lt;operator&gt; &lt;number|word&gt; &lt;number|word&gt;</code></li>
<li><code>and</code> , <code>or</code> ： <code>&lt;operator&gt; &lt;bool&gt; &lt;bool&gt;</code></li>
<li><code>not</code> ： <code>not &lt;bool&gt;</code></li>
</ul>
</li>
</ul>
<ul>
<li><p><code>readlist</code> ：返回一个从标准输入读取的一行，构成一个表，行中每个以空格分隔的部分是list的一个元素</p>
<ul>
<li>用<code>readlist</code>读入的只可能是单层的表</li>
</ul>
</li>
</ul>
<ul>
<li><code>repeat &lt;number&gt; &lt;list&gt;</code> ：运行list中的代码number次</li>
</ul>
<h3 id="函数定义和调用"><a href="#函数定义和调用" class="headerlink" title="函数定义和调用"></a>函数定义和调用</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><p><code>make &lt;name&gt; [&lt;list1&gt; &lt;list2&gt;]</code>，其中</p>
<ul>
<li>name为函数名</li>
<li>list1为参数表</li>
<li>list2为操作表</li>
</ul>
<p>以下为函数定义的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">make &quot;prt [</span><br><span class="line">	[a]</span><br><span class="line">	[print :a]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h4><p><code>&lt;functionName&gt; &lt;arglist&gt;</code>，其中：</p>
<ul>
<li><code>&lt;functionName&gt;</code>为make中定义的函数名，不需要双引号<code>&quot;</code></li>
<li><code>&lt;arglist&gt;</code>是参数表<code>&lt;arglist&gt;</code>中的值和函数定义时的<code>&lt;list1&gt;</code>中名字进行一一对应绑定</li>
</ul>
<p>以下为函数调用的例子：<code>prt &quot;hello</code></p>
<h4 id="本地变量"><a href="#本地变量" class="headerlink" title="本地变量"></a>本地变量</h4><ul>
<li><p>在函数中访问（读取）变量的值的时候，首先访问本地，如果本地不存在，则访问全局</p>
</li>
<li><p>在函数中做 <code>make</code> 时，永远只写本地：</p>
<ul>
<li>检查本函数内是否存在这个名字，如果存在，则对已有的变量赋值；</li>
<li>否，则在本地定义⼀个新的变量</li>
</ul>
</li>
</ul>
<h4 id="函数相关的操作"><a href="#函数相关的操作" class="headerlink" title="函数相关的操作"></a>函数相关的操作</h4><ul>
<li><p><code>output &lt;value&gt;</code> ：设定value为返回给调用者的值，但是不停止执行</p>
</li>
<li><p><code>stop</code> ：停止执行</p>
</li>
<li><code>export</code> ：将本地make的值输出到全局<ul>
<li>如果全局没有这个变量，则增加⼀个全局变量</li>
<li>如果全局已经有了同名的变量，则替换全部变量的值</li>
</ul>
</li>
</ul>
<h3 id="表达式计算"><a href="#表达式计算" class="headerlink" title="表达式计算"></a>表达式计算</h3><p>允许使用以下运算符对数字进行计算：<code>+-*/%()</code></p>
<p>为了方便便识别，要求表达式的外⾯面必须有括号<code>()</code>包围。</p>
<p>支持负数</p>
<blockquote>
<p> (5+-2)   –&gt;  3.0</p>
</blockquote>
<h3 id="判断"><a href="#判断" class="headerlink" title="判断"></a>判断</h3><ul>
<li><code>if &lt;bool&gt; &lt;list1&gt; &lt;list2&gt;</code> ：如果bool为真，则执行list1，否则执行list2。list均可以为空表</li>
<li><code>isnumber &lt;value&gt;</code> ：返回value是否是数字</li>
<li><code>isword &lt;value&gt;</code> ：返回value是否是字</li>
<li><code>islist &lt;value&gt;</code> ：返回value是否是表</li>
<li><code>isbool &lt;value&gt;</code> ：返回value是否是布尔量</li>
<li><code>isempty &lt;word|list&gt;</code> : 返回word或list是否是空</li>
</ul>
<h3 id="数值计算"><a href="#数值计算" class="headerlink" title="数值计算"></a>数值计算</h3><ul>
<li><code>random &lt;number&gt;</code> ：返回[0,number)的一个随机数</li>
<li><code>sqrt &lt;number&gt;</code> ：返回number的平方根</li>
<li><code>int &lt;number&gt;</code> : floor the int</li>
</ul>
<h3 id="字表处理"><a href="#字表处理" class="headerlink" title="字表处理"></a>字表处理</h3><ul>
<li><p><code>word &lt;word&gt; &lt;word|number|bool&gt;</code> ：将两个word合并为一个word，第二个值可以是word、number或bool</p>
</li>
<li><p><code>sentence &lt;value1&gt; &lt;value2&gt;</code> ：将value1和value2合并成一个表，两个值的元素并列，value1的在value2的前面</p>
<blockquote>
<p>返回结果为list<br>sentence “a “b  -&gt;  a b<br>sentence [a] [b]  -&gt;  a b<br>sentence “a [b] -&gt;  a b<br>sentence [a [b c]  d] [x y]  -&gt;  a [b c] d x y</p>
</blockquote>
</li>
<li><p><code>list &lt;value1&gt; &lt;value2&gt;</code> ：将两个值合并为一个表，如果值为表，则不打开这个表</p>
<blockquote>
<p>list “a “b -&gt; a b<br>list [a] [b] -&gt; [a] [b]</p>
</blockquote>
</li>
<li><p><code>join &lt;list&gt; &lt;value&gt;</code> ：将value作为list的最后一个元素加入到list中（如果value是表，则整个value成为表的最后一个元素）</p>
<blockquote>
<p>join [a b] “c  -&gt;  a b c<br>join [a b] [c]  -&gt;  a b [c]<br>join [a b] first [c]  -&gt;  a b c</p>
</blockquote>
</li>
<li><p><code>first &lt;word|list&gt;</code> ：返回word的第一个字符，或list的第一个元素</p>
<blockquote>
<p>first “abc  -&gt;  a (word)<br>first [a b c]  -&gt;  a (word)<br>first [[a] b]  -&gt;  a (list)<br>first “123  -&gt;  1 (word)<br>islist first []  -&gt;  true<br>isempty first []  -&gt;  true</p>
</blockquote>
</li>
<li><p><code>last &lt;word|list&gt;</code> ：返回word的最后一个字符，list的最后一个元素</p>
</li>
<li><p><code>butfirst &lt;word|list&gt;</code> ：返回除第一个元素外剩下的表，或除第一个字符外剩下的字</p>
<blockquote>
<p>注意返回是list<br>islist butfirst [a b c]  -&gt;  true<br>islist butfirst [a b]  -&gt;  true</p>
</blockquote>
</li>
<li><p><code>butlast &lt;word|list&gt;</code> ：返回除最后一个元素外剩下的表，或除最后一个字符外剩下的字</p>
</li>
</ul>
<h3 id="其他操作"><a href="#其他操作" class="headerlink" title="其他操作"></a>其他操作</h3><ul>
<li><p><code>wait &lt;number&gt;</code> ：等待number个ms</p>
</li>
<li><p><code>save &lt;word&gt;</code> ：保存当前命名空间在word文件中</p>
<blockquote>
<p>save “a.mua</p>
</blockquote>
</li>
<li><p><code>load &lt;word&gt;</code> ：从word文件中装载内容，加入当前命名空间</p>
</li>
<li><p><code>erall</code> ：清除当前命名空间的全部内容</p>
</li>
<li><p><code>poall</code> ：列出当前命名空间的全部名字</p>
</li>
</ul>
<h3 id="既有名字"><a href="#既有名字" class="headerlink" title="既有名字"></a>既有名字</h3><p>系统提供了一些常⽤用的量量，或可以由其他操作实现但是常用的操作，作为固有的名字。这些名字是可以被删除（erase）的。</p>
<ul>
<li><code>pi</code> ：3.14159</li>
<li><code>run &lt;list&gt;</code> ：运行list中的代码</li>
</ul>
<h2 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h2><h3 id="整体结构"><a href="#整体结构" class="headerlink" title="整体结构"></a>整体结构</h3><p>项目中创建的class介绍如下：</p>
<h4 id="command"><a href="#command" class="headerlink" title="command"></a><code>command</code></h4><p>MUA语句中的每个单词都是一个<code>command</code>，包含<code>number</code>、<code>bool</code>、<code>list</code>、<code>word</code>、<code>operator</code>、<code>expression</code>、<code>file</code>几个类别，具有名字、类别、值（针对number、bool、list、expression，根据类别不同有不同类型的值）几个属性（其中list会被看成一个整体）。</p>
<blockquote>
<p> 例如语句 if eq thing “a 6 [print :a] [print 0]</p>
<table>
<thead>
<tr>
<th>name</th>
<th>type</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr>
<td>if</td>
<td>operation</td>
<td>/</td>
</tr>
<tr>
<td>eq</td>
<td>operation</td>
<td>/</td>
</tr>
<tr>
<td>thing</td>
<td>operation</td>
<td>/</td>
</tr>
<tr>
<td>“a</td>
<td>word</td>
<td>/</td>
</tr>
<tr>
<td>6</td>
<td>number</td>
<td>6 (double)</td>
</tr>
<tr>
<td>[print :a]</td>
<td>list</td>
<td>[print :a] (String)</td>
</tr>
<tr>
<td>[print 0]</td>
<td>list</td>
<td>[print 0] (String)</td>
</tr>
</tbody>
</table>
</blockquote>
<p><code>command</code>的构造可以有三种方式，构造一个空的command、提供name和type（在构造时根据name判断并填充value）、提供name（构造时根据name判断并填充type和value），具体实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">command()&#123;&#125;</span><br><span class="line"></span><br><span class="line">command(String name, String type)&#123;</span><br><span class="line">    commandName = name;</span><br><span class="line">    commandType = type;</span><br><span class="line">    setCommandValue(commandType);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">command(String name)&#123;</span><br><span class="line">    commandName = name;</span><br><span class="line">    analyzeType(name);</span><br><span class="line">    setCommandValue(commandType);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中<code>analyzeType</code>是用于根据name判断command类型的方法，setCommandValue是根据name和type设置value的方法。这两个方法的实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">analyzeType</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> firstChar = name.charAt(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span>( (firstChar &gt;= <span class="string">'0'</span> &amp;&amp; firstChar &lt;= <span class="string">'9'</span>) || firstChar == <span class="string">'-'</span>) &#123;</span><br><span class="line">        <span class="comment">//number eg.6</span></span><br><span class="line">        commandType = <span class="string">"number"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(firstChar == <span class="string">'"'</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(isNumber(name.substring(<span class="number">1</span>))) &#123;</span><br><span class="line">            <span class="comment">//number eg."6</span></span><br><span class="line">            commandName = name.substring(<span class="number">1</span>);</span><br><span class="line">            commandType = <span class="string">"number"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//word eg."ab</span></span><br><span class="line">            commandType = <span class="string">"word"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(name.equals(<span class="string">"true"</span>) || name.equals(<span class="string">"false"</span>)) &#123;</span><br><span class="line">        <span class="comment">//boolean (true/false)</span></span><br><span class="line">        commandType = <span class="string">"bool"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(firstChar == <span class="string">'['</span>)&#123;</span><br><span class="line">        <span class="comment">//list</span></span><br><span class="line">        commandType = <span class="string">"list"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(firstChar == <span class="string">'('</span>) &#123;</span><br><span class="line">        <span class="comment">//expression</span></span><br><span class="line">        commandType = <span class="string">"expression"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(name.indexOf(<span class="string">'.'</span>) != -<span class="number">1</span> &amp;&amp; name.trim().substring(name.indexOf(<span class="string">'.'</span>)).equals(<span class="string">".mua"</span>)) &#123;</span><br><span class="line">        commandType = <span class="string">"file"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//operator</span></span><br><span class="line">        commandType = <span class="string">"operator"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCommandValue</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(type.equals(<span class="string">"number"</span>)) &#123;</span><br><span class="line">        numValue = Double.valueOf(commandName);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(type.equals(<span class="string">"bool"</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span>(commandName.equals(<span class="string">"true"</span>)) &#123;</span><br><span class="line">            boolValue = <span class="keyword">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            boolValue = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(type.equals(<span class="string">"list"</span>))&#123;</span><br><span class="line">        listString = commandName.substring(<span class="number">1</span>, commandName.length()-<span class="number">1</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(type.equals(<span class="string">"expression"</span>)) &#123;</span><br><span class="line">        exprString = commandName.substring(<span class="number">1</span>, commandName.length()-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="commandStack"><a href="#commandStack" class="headerlink" title="commandStack"></a><code>commandStack</code></h4><p>输入的MUA语句会被作为一个<code>commandStack</code>类存储起来，顾名思义，<code>commandStack</code>是一个由很多<code>command</code>组成的stack，通过<code>Vector</code>来组织。例如<code>if eq thing &quot;a 6 [print :a] [print 0]</code>将会被分为七个<code>command</code>，存储在一个<code>commandStack</code>里。</p>
<p><code>commandStack</code>的构造包括空白构造、根据一个MUA语句进行构造两种方式，实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">commandStack()&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//put a line of commands into stack</span></span><br><span class="line">commandStack(String line)&#123;</span><br><span class="line">    line = line.replace(<span class="string">":"</span>, <span class="string">"thing \""</span>).trim();</span><br><span class="line">    <span class="keyword">while</span>(!line.equals(<span class="string">""</span>)) &#123;</span><br><span class="line">        command newCom;</span><br><span class="line">        <span class="keyword">if</span>(line.charAt(<span class="number">0</span>) == <span class="string">'['</span>) &#123;</span><br><span class="line">            <span class="comment">//list</span></span><br><span class="line">            <span class="keyword">int</span> comp = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;line.length(); i++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(line.charAt(i) == <span class="string">'['</span>) &#123;</span><br><span class="line">                    comp--;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(line.charAt(i) == <span class="string">']'</span>) &#123;</span><br><span class="line">                    comp++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(comp == <span class="number">0</span>) &#123;</span><br><span class="line">                    newCom = <span class="keyword">new</span> command((line.substring(<span class="number">0</span>, i+<span class="number">1</span>)).trim());</span><br><span class="line">                    commands.addElement(newCom);</span><br><span class="line">                    <span class="keyword">if</span>(i == line.length() - <span class="number">1</span>) &#123;</span><br><span class="line">                        line = <span class="string">""</span>;</span><br><span class="line">                    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                        line = line.substring(i+<span class="number">1</span>).trim();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(line.charAt(<span class="number">0</span>) == <span class="string">'('</span>) &#123;</span><br><span class="line">            <span class="comment">//expression</span></span><br><span class="line">            <span class="keyword">int</span> comp = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;line.length(); i++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(line.charAt(i) == <span class="string">'('</span>) &#123;</span><br><span class="line">                    comp--;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(line.charAt(i) == <span class="string">')'</span>) &#123;</span><br><span class="line">                    comp++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(comp == <span class="number">0</span>) &#123;</span><br><span class="line">                    newCom = <span class="keyword">new</span> command((line.substring(<span class="number">0</span>, i+<span class="number">1</span>)).trim());</span><br><span class="line">                    commands.addElement(newCom);</span><br><span class="line">                    <span class="keyword">if</span>(i == line.length() - <span class="number">1</span>) &#123;</span><br><span class="line">                        line = <span class="string">""</span>;</span><br><span class="line">                    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                        line = line.substring(i+<span class="number">1</span>).trim();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(line.indexOf(<span class="string">' '</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">//more than one command left</span></span><br><span class="line">            newCom = <span class="keyword">new</span> command(line.substring(<span class="number">0</span>, line.indexOf(<span class="string">' '</span>)).trim());</span><br><span class="line">            commands.addElement(newCom); </span><br><span class="line">            line = line.substring(line.indexOf(<span class="string">' '</span>)+<span class="number">1</span>).trim(); </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            newCom = <span class="keyword">new</span> command(line);</span><br><span class="line">            commands.addElement(newCom);</span><br><span class="line">            line = <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>commandStack</code>的方法仿照<code>Vector</code>，包含<code>get(index)</code>、<code>setElementAt(newCommand, index)</code>、<code>insertElementAt(newCommand, index)</code>、<code>removeElementAt(index)</code>、<code>subStack(begin, end)</code>、<code>subStack(begin)</code>，便于操作。</p>
<h4 id="variable"><a href="#variable" class="headerlink" title="variable"></a><code>variable</code></h4><p>变量。每个被<code>make</code>过的<code>word</code>都会被作为一个变量存储起来，包含<code>number</code>、<code>bool</code>、<code>word</code>、<code>list</code>几个类别，具有名字、类别、值（不同类别有不同类型的值）几个属性。每一种类别的变量都有一个单独的构造函数，此外还有拷贝构造，以及未赋值的变量构造。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//empty variable</span></span><br><span class="line">variable(String name)&#123;</span><br><span class="line">    varName = name;</span><br><span class="line">    varType = <span class="string">""</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//eg. make "a 6</span></span><br><span class="line">variable(String name, <span class="keyword">double</span> value)&#123;</span><br><span class="line">    varName = name;</span><br><span class="line">    numValue = value;</span><br><span class="line">    varType = <span class="string">"number"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//eg. make "a true</span></span><br><span class="line">variable(String name, <span class="keyword">boolean</span> bool)&#123;</span><br><span class="line">    varName = name;</span><br><span class="line">    boolValue = bool;</span><br><span class="line">    varType = <span class="string">"bool"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//eg. make "b "a, varType of b is word</span></span><br><span class="line">variable(String name, String str)&#123;</span><br><span class="line">    varName = name;</span><br><span class="line">    <span class="keyword">if</span>(str.charAt(<span class="number">0</span>) == <span class="string">'['</span>) &#123;</span><br><span class="line">        changeListStr(str);</span><br><span class="line">        varType = <span class="string">"list"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        wordName = str;</span><br><span class="line">        varType = <span class="string">"word"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//copy construction</span></span><br><span class="line">variable(variable <span class="keyword">var</span>) &#123;</span><br><span class="line">    varName = <span class="keyword">var</span>.getName();</span><br><span class="line">    varType = <span class="keyword">var</span>.getType();</span><br><span class="line">    <span class="keyword">if</span>(varType == <span class="string">"number"</span>) &#123;</span><br><span class="line">        numValue = <span class="keyword">var</span>.getNumValue();</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(varType == <span class="string">"bool"</span>) &#123;</span><br><span class="line">        boolValue = <span class="keyword">var</span>.getBoolValue();</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        wordName = <span class="keyword">var</span>.getWordName();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有<code>getValue()</code>、<code>chageValue(newValue)</code>方法，可以用于获取和改变变量的值</p>
<h4 id="varStack"><a href="#varStack" class="headerlink" title="varStack"></a><code>varStack</code></h4><p><code>varStack</code> 即 <code>variable</code>组成的 stack，存储当前命名空间下的所有变量，整个程序会有一个全局的<code>varStack</code>，每个函数都有其对应的局部的<code>varStack</code>，使用<code>Vector</code>来管理。</p>
<p>含有<code>isname</code>方法，用于判断当前变量空间是否含有对应名字的变量。</p>
<p>含有往<code>varStack</code>中添加<code>variable</code>的方法，有<code>add(variable)</code>、<code>add(name)</code>、<code>add(name, value)</code>几种方式，要注意的是，如果在栈中有与新添加的变量同名的变量，则进行覆盖。</p>
<p>可以根据name来移除变量（<code>remove(name)</code>）、获取变量的值（<code>getValue(name)</code>）、查找对应变量（<code>find(name)</code>）。</p>
<p>此外，包含仿照<code>Vector</code>的方法，<code>size()</code> <code>removeElementAt(index)</code> 。</p>
<h4 id="function"><a href="#function" class="headerlink" title="function"></a><code>function</code></h4><p>函数。包含名字、变量列表、操作列表（分别用stack来存当前函数对应的<code>variable</code>和<code>commandStack</code>，每一句操作都是一个commandStack）</p>
<p>除了空白构造和拷贝构造之外，可以通过提供名字、变量列表、操作列表来构造，其中，变量列表和操作列表以<code>String</code>输入，在构造时存储在对应stack中，通过<code>Vector</code>来管理</p>
<h4 id="funcStack"><a href="#funcStack" class="headerlink" title="funcStack"></a><code>funcStack</code></h4><p><code>funcStack</code> 即<code>function</code>组成的 stack，存储所有的函数</p>
<h4 id="exprMember"><a href="#exprMember" class="headerlink" title="exprMember"></a><code>exprMember</code></h4><p>表达式中的每个成员，包含名字、类型（number/operator）、值（针对number）三个属性</p>
<h4 id="expression"><a href="#expression" class="headerlink" title="expression"></a><code>expression</code></h4><p>用stack存储一整句表达式，可以通过操作stack来进行运算。</p>
<p>要注意的是，<code>-</code>可能有减法和负数两种含义，要在构造时进行判断，如果为减法，<code>exprMember</code>的类型将是<code>operator</code>，如果是负数，则与其后面的数字一起组成新的数值，类型是<code>number</code>。</p>
<p>将一整句表达式拆开并存储为由<code>exprMember</code>组成的stack的构造如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">expression(String expr)&#123;</span><br><span class="line">    exprMember newMem;</span><br><span class="line">    expr = expr.trim();</span><br><span class="line">    <span class="keyword">while</span>(!expr.equals(<span class="string">""</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span>(Character.isDigit(expr.charAt(<span class="number">0</span>)))&#123;</span><br><span class="line">            <span class="keyword">if</span>(expr.length() == <span class="number">1</span>) &#123;</span><br><span class="line">                newMem = <span class="keyword">new</span> exprMember(expr.substring(<span class="number">0</span>, <span class="number">1</span>), <span class="string">"number"</span>);</span><br><span class="line">                members.add(newMem);</span><br><span class="line">                expr = expr.substring(<span class="number">1</span>).trim();</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;expr.length(); i++) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(!Character.isDigit(expr.charAt(i)) &amp;&amp; expr.charAt(i) != <span class="string">'.'</span> || i == expr.length()-<span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span>(i == expr.length()-<span class="number">1</span>) &#123;</span><br><span class="line">                            newMem = <span class="keyword">new</span> exprMember(expr.substring(<span class="number">0</span>, i+<span class="number">1</span>), <span class="string">"number"</span>);</span><br><span class="line">                        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                            newMem = <span class="keyword">new</span> exprMember(expr.substring(<span class="number">0</span>, i), <span class="string">"number"</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        members.add(newMem);</span><br><span class="line">                        expr = expr.substring(i).trim();</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(expr.charAt(<span class="number">0</span>) == <span class="string">'-'</span> &amp;&amp; (members.size() == <span class="number">0</span> || members.get(members.size()-<span class="number">1</span>).getType() == <span class="string">"operator"</span>)) &#123;</span><br><span class="line">            <span class="comment">//judge whether the '-' represents negative or minus</span></span><br><span class="line">            <span class="comment">//if it is negative, do it first</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;expr.length(); i++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!Character.isDigit(expr.charAt(i))) &#123;</span><br><span class="line">                    newMem = <span class="keyword">new</span> exprMember(expr.substring(<span class="number">0</span>, i), <span class="string">"number"</span>);</span><br><span class="line">                    members.add(newMem);</span><br><span class="line">                    expr = expr.substring(i).trim();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            newMem = <span class="keyword">new</span> exprMember(expr.substring(<span class="number">0</span>, <span class="number">1</span>), <span class="string">"operator"</span>);</span><br><span class="line">            members.add(newMem);</span><br><span class="line">            expr = expr.substring(<span class="number">1</span>).trim();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="整体实现"><a href="#整体实现" class="headerlink" title="整体实现"></a>整体实现</h3><p>整体的实现通过栈进行，分析<code>commandStack</code>中各<code>command</code>的属性，对其中的<code>operator</code>进行对应操作，取出<code>operator</code>以及对应的操作数，操作完之后把结果放回栈中。</p>
<h4 id="预处理"><a href="#预处理" class="headerlink" title="预处理"></a>预处理</h4><p>为方便后续处理，在通过MUA语句构造<code>commandStack</code>时，将所有的<code>：</code>都替换成<code>thing &quot;</code>。</p>
<h4 id="读入MUA语句"><a href="#读入MUA语句" class="headerlink" title="读入MUA语句"></a>读入MUA语句</h4><p>读入时跳过所有注释</p>
<p>读入时要注意的是判断是否读完一整句话，如果没有读完（list或者expression，或者一句话的操作数不足），需要继续读下一行，拼起来作为完整的语句。</p>
<h4 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h4><p>由于可能会出现多个语句在同一行的情况，因此只能从前往后运行。</p>
<p>判断当前operator的操作数是否被运算完全，即后面的对应数量的<code>command</code>是否都不是<code>operator</code>类型。如果都不是，说明一个语句已完全，则运行当前<code>operator</code>，否则，递归判断遇到的下一个<code>operator</code>。</p>
<h4 id="函数运行"><a href="#函数运行" class="headerlink" title="函数运行"></a>函数运行</h4><p>函数运行时，先按照变量列表，使用传递给函数的参数对函数变量空间的对应变量进行值改变，然后依次运行操作列表中的操作。通过依次调用<code>funcStack</code>和<code>function</code>中负责运行函数的方法进行运行。</p>
<p>需要注意的是：</p>
<ul>
<li><p>如果在操纵列表中出现<code>stop</code>，直接返回。</p>
</li>
<li><p>为了实现递归操作，在运行函数时使用拷贝构造函数，构造一个完全相同的新函数再运行，而非直接操作原来的函数。</p>
</li>
</ul>
<p>实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(func.isFunc(<span class="string">"\""</span> + oper_command.get(begin_index).getCommandName())) &#123;</span><br><span class="line">    String funcName = <span class="string">"\""</span> + oper_command.get(begin_index).getCommandName();</span><br><span class="line">    String funcVars = <span class="string">""</span>;</span><br><span class="line">    <span class="comment">//pass parameters to the function in order</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;func.funcVarNum(funcName); i++) &#123;</span><br><span class="line">        funcVars += oper_command.get(begin_index+i+<span class="number">1</span>).getCommandName() + <span class="string">" "</span>;</span><br><span class="line">    &#125;			</span><br><span class="line">    commandStack funcVarStack = <span class="keyword">new</span> commandStack(funcVars);</span><br><span class="line">    <span class="comment">//run the function</span></span><br><span class="line">    retstr = func.runFunc(funcName, funcVarStack);</span><br><span class="line">    <span class="keyword">if</span>(retstr.equals(<span class="string">""</span>) || retstr.equals(<span class="string">"STOP!!!!"</span>)) &#123;</span><br><span class="line">        <span class="comment">//no output or is stopped (in case of recursion) </span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=func.funcVarNum(funcName); i&gt;=<span class="number">0</span>; i--) &#123;</span><br><span class="line">            oper_command.removeElementAt(begin_index+i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        newCom = <span class="keyword">new</span> command(retstr);</span><br><span class="line">        oper_command.setElementAt(newCom, begin_index);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=func.funcVarNum(funcName); i&gt;<span class="number">0</span>; i--) &#123;</span><br><span class="line">            oper_command.removeElementAt(begin_index+i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>funcStack</code>中的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">runFunc</span><span class="params">(String funcName, commandStack funcVarStack)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    String ret = <span class="string">""</span>;</span><br><span class="line">    <span class="comment">//find the newly created function to run</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=functions.size()-<span class="number">1</span>; i&gt;=<span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">if</span>(functions.get(i).getName().equals(funcName)) &#123;</span><br><span class="line">            <span class="comment">//create a same function to run (in case of recursion)</span></span><br><span class="line">            function new_func = <span class="keyword">new</span> function(functions.get(i));</span><br><span class="line">            ret = new_func.run(funcVarStack);</span><br><span class="line">            <span class="keyword">if</span>(ret == <span class="string">"STOP!!!!"</span>) &#123;</span><br><span class="line">                <span class="comment">//the function is stopped </span></span><br><span class="line">                <span class="keyword">return</span> ret;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>function</code>中的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">run</span><span class="params">(commandStack funcVarStack)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    String ret = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">int</span> var_index = <span class="number">0</span>;</span><br><span class="line">    String varName = <span class="string">""</span>;</span><br><span class="line">    String varValue = <span class="string">""</span>;</span><br><span class="line">    <span class="comment">//passing parameters</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;getVarNum(); i++) &#123;</span><br><span class="line">        varName = funcVariable.get(i).getName();</span><br><span class="line">        varValue = funcVarStack.get(i).getCommandName();</span><br><span class="line">        funcVariable.get(i).changeValue(varValue);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//run each operations in order</span></span><br><span class="line">    commandStack nextComStack;</span><br><span class="line">    <span class="keyword">while</span>(funcOperation.size()!=<span class="number">0</span>) &#123;</span><br><span class="line">        nextComStack = funcOperation.get(<span class="number">0</span>);</span><br><span class="line">        ret = CommandAnalyze.judge(nextComStack, funcVariable, <span class="number">0</span>);</span><br><span class="line">        funcOperation.remove(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//if the function is stopped</span></span><br><span class="line">        <span class="keyword">if</span>(ret == <span class="string">"STOP!!!!"</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="表达式运算"><a href="#表达式运算" class="headerlink" title="表达式运算"></a>表达式运算</h4><p>为方便起见，在表达式运算中与<code>commandStack</code>中的处理相反，将所有<code>thing &quot;</code>都替换成<code>:</code>来操作。</p>
<p>表达式运算的几个特殊情况：</p>
<ul>
<li>处理内部含有<code>()</code>的表达式，通过递归进行</li>
<li>含有变量的表达式，检测到下一个字符是<code>+-*/%</code>中的一个，或者到达表达式结尾，则说明变量名结束。根据检测到的变量名，在变量空间中用对应的数值来替代</li>
<li>含有函数的表达式，检测函数名的方式与检测变量名类似。先运行对应函数，然后再将运算得到的值替代表达式中的函数名，运算表达式。</li>
</ul>
<p>实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">manageExpression</span><span class="params">(String expression, varStack vars)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//expression with()</span></span><br><span class="line">    expression = expression.trim();</span><br><span class="line">    expression = expression.substring(<span class="number">1</span>, expression.length()-<span class="number">1</span>);</span><br><span class="line">    expression = expression.replace(<span class="string">"thing \""</span>, <span class="string">":"</span>);</span><br><span class="line">    String result = <span class="string">""</span>;</span><br><span class="line">    <span class="comment">//contains (), recursive</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;expression.length(); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(expression.charAt(i) == <span class="string">'('</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> comp = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=i; j&lt;expression.length(); j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(expression.charAt(j) == <span class="string">'('</span>) &#123;</span><br><span class="line">                    comp--;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(expression.charAt(j) == <span class="string">')'</span>) &#123;</span><br><span class="line">                    comp++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(comp == <span class="number">0</span>) &#123;</span><br><span class="line">                    String newExp = expression.substring(i, j+<span class="number">1</span>);</span><br><span class="line">                    result = manageExpression(newExp, vars);</span><br><span class="line">                    expression = expression.substring(<span class="number">0</span>, i) + result + expression.substring(j+<span class="number">1</span>);</span><br><span class="line">                    i--;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//vars</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;expression.length(); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(expression.charAt(i) == <span class="string">':'</span>) &#123;</span><br><span class="line">            String varName;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>; j&lt;expression.length(); j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(isOper(expression.charAt(j)) || j == expression.length()-<span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(j == expression.length()-<span class="number">1</span>) &#123;</span><br><span class="line">                        varName = <span class="string">"\""</span> + expression.substring(i+<span class="number">1</span>, j+<span class="number">1</span>).trim();</span><br><span class="line">                        expression = expression.substring(<span class="number">0</span>,i) + vars.getValue(varName);</span><br><span class="line">                    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                        varName = <span class="string">"\""</span> + expression.substring(i+<span class="number">1</span>, j).trim();</span><br><span class="line">                        expression = expression.substring(<span class="number">0</span>,i) + vars.getValue(varName) + expression.substring(j);</span><br><span class="line">                    &#125;</span><br><span class="line">                    i--;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//function</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;expression.length(); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!Character.isDigit(expression.charAt(i)) &amp;&amp; !isOper(expression.charAt(i)) &amp;&amp; expression.charAt(i) != <span class="string">' '</span> &amp;&amp; expression.charAt(i) != <span class="string">'.'</span>) &#123;</span><br><span class="line">            String funcName;</span><br><span class="line">            String retstr;</span><br><span class="line">            commandStack funcVarStack;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=i; j&lt;expression.length();  j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(expression.charAt(j) == <span class="string">' '</span>) &#123;</span><br><span class="line">                    funcName = <span class="string">"\""</span> + expression.substring(i, j);</span><br><span class="line">                    <span class="comment">//single variable</span></span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> k=j+<span class="number">1</span>; k&lt;expression.length(); k++) &#123;</span><br><span class="line">                        <span class="keyword">if</span>(expression.charAt(k) == <span class="string">' '</span> || k == expression.length()-<span class="number">1</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span>(k == expression.length()-<span class="number">1</span>) &#123;</span><br><span class="line">                                funcVarStack = <span class="keyword">new</span> commandStack(expression.substring(j+<span class="number">1</span>, k+<span class="number">1</span>));</span><br><span class="line">                                retstr = func.runFunc(funcName, funcVarStack);</span><br><span class="line">                                expression = expression.substring(<span class="number">0</span>,i) + retstr;</span><br><span class="line">                            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                                funcVarStack = <span class="keyword">new</span> commandStack(expression.substring(j+<span class="number">1</span>, k+<span class="number">1</span>));</span><br><span class="line">                                retstr = func.runFunc(funcName, funcVarStack);</span><br><span class="line">                                expression = expression.substring(<span class="number">0</span>,i) + retstr + expression.substring(k);</span><br><span class="line">                            &#125;</span><br><span class="line">                            i--;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    expression expr = <span class="keyword">new</span> expression(expression);</span><br><span class="line">    result = expr.calculate();</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中<code>calculate()</code>是<code>expression</code>类中的方法，原理是通过<code>expression</code>中构造的栈进行运算，按顺序取<code>operator</code>，同时取出它两边的<code>number</code>作为operand进行运算，然后将新的值放回到栈中。由于表达式中只有<code>+-*/%</code>几种运算符，就根据优先级顺序，先处理<code>*/%</code>，再处理<code>+-</code>。</p>
<h4 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h4><h5 id="make-lt-name-gt-lt-value-gt-或make-lt-name-gt-lt-list1-gt-lt-list2-gt"><a href="#make-lt-name-gt-lt-value-gt-或make-lt-name-gt-lt-list1-gt-lt-list2-gt" class="headerlink" title="make &lt;name&gt; &lt;value&gt;或make &lt;name&gt; [&lt;list1&gt; &lt;list2&gt;]"></a><code>make &lt;name&gt; &lt;value&gt;</code>或<code>make &lt;name&gt; [&lt;list1&gt; &lt;list2&gt;]</code></h5><p>如果定义的是函数，创建新的函数并加入函数栈中。如果定义的是变量，创建新的变量并加入当前变量空间的变量栈中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">"make"</span>:</span><br><span class="line">    command next1 = oper_command.get(begin_index+<span class="number">1</span>);</span><br><span class="line">    command next2 = oper_command.get(begin_index+<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">if</span>(next2.getCommandType().equals(<span class="string">"list"</span>)) &#123;</span><br><span class="line">        <span class="comment">//if the second operand is a list, the first operand is the name of a function</span></span><br><span class="line">        <span class="comment">//add the function to stack</span></span><br><span class="line">        func.add(next1.getCommandName(), next2.getCommandName());</span><br><span class="line">        <span class="comment">//store the number of operands of the new function</span></span><br><span class="line">        <span class="keyword">if</span>(func.funcVarNum(next1.getCommandName()) == <span class="number">1</span>) &#123;</span><br><span class="line">            oneOperand.add(next1.getCommandName().substring(<span class="number">1</span>));</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(func.funcVarNum(next1.getCommandName()) == <span class="number">2</span>) &#123;</span><br><span class="line">            twoOperand.add(next1.getCommandName().substring(<span class="number">1</span>));</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(func.funcVarNum(next1.getCommandName()) == <span class="number">3</span>) &#123;</span><br><span class="line">            threeOperand.add(next1.getCommandName().substring(<span class="number">1</span>));</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(func.funcVarNum(next1.getCommandName()) == <span class="number">0</span>) &#123;</span><br><span class="line">            noOperand.add(next1.getCommandName().substring(<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(next2.getCommandType().equals(<span class="string">"word"</span>)) &#123;</span><br><span class="line">        <span class="comment">//eg. make "b "a -&gt; thing "b == a, thing :b == value of a</span></span><br><span class="line">        oper_var.add(next1.getCommandName(), next2.getCommandName());</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(next2.getCommandType().equals(<span class="string">"number"</span>)) &#123;</span><br><span class="line">        <span class="comment">//eg. make "a 6 -&gt; put 6 in a</span></span><br><span class="line">        oper_var.add(next1.getCommandName(), next2.getNumValue());</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(next2.getCommandType().equals(<span class="string">"list"</span>))&#123;</span><br><span class="line">        oper_var.add(next1.getCommandName(), next2.getListString());</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//eg. make "a true</span></span><br><span class="line">        oper_var.add(next1.getCommandName(), next2.getBoolValue());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//remove the used commands</span></span><br><span class="line">    oper_command.removeElementAt(begin_index+<span class="number">2</span>);</span><br><span class="line">    oper_command.removeElementAt(begin_index+<span class="number">1</span>);</span><br><span class="line">    oper_command.removeElementAt(begin_index);</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<h5 id="thing-lt-name-gt"><a href="#thing-lt-name-gt" class="headerlink" title="thing &lt;name&gt;"></a><code>thing &lt;name&gt;</code></h5><p>从变量栈中取出对应变量的值并取代</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">"thing"</span>:</span><br><span class="line">    command next = oper_command.get(begin_index+<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//get the next command </span></span><br><span class="line">    newCom = <span class="keyword">new</span> command(oper_var.getValue(next.getCommandName()), oper_var.getType(next.getCommandName()));</span><br><span class="line">    oper_command.setElementAt(newCom, begin_index);</span><br><span class="line">    oper_command.removeElementAt(begin_index+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<h5 id="erase-lt-name-gt"><a href="#erase-lt-name-gt" class="headerlink" title="erase &lt;name&gt;"></a><code>erase &lt;name&gt;</code></h5><p>从变量栈中删掉对应名字的变量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">"erase"</span>:</span><br><span class="line">    next = oper_command.get(begin_index+<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//remove the next command</span></span><br><span class="line">    oper_var.remove(next.getCommandName());</span><br><span class="line">    oper_command.removeElementAt(begin_index+<span class="number">1</span>);</span><br><span class="line">    oper_command.removeElementAt(begin_index);</span><br><span class="line">	<span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<h5 id="isname-lt-word-gt"><a href="#isname-lt-word-gt" class="headerlink" title="isname &lt;word&gt;"></a><code>isname &lt;word&gt;</code></h5><p>在变量栈和函数栈中都进行查找，如果当前word存在于变量栈或函数栈中，则为name</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">"isname"</span>:</span><br><span class="line">    String result;</span><br><span class="line">    <span class="comment">//is a variable or a function, true, else, false</span></span><br><span class="line">    <span class="keyword">if</span>((oper_var.isname(oper_command.get(begin_index+<span class="number">1</span>).getCommandName()).equals(<span class="string">"true"</span>)) || (func.isFunc(oper_command.get(begin_index+<span class="number">1</span>).getCommandName())) ) &#123;</span><br><span class="line">        result = <span class="string">"true"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        result = <span class="string">"false"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    newCom = <span class="keyword">new</span> command(result, <span class="string">"bool"</span>);</span><br><span class="line">    oper_command.setElementAt(newCom, begin_index);</span><br><span class="line">    oper_command.removeElementAt(begin_index+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<h5 id="print-lt-value-gt"><a href="#print-lt-value-gt" class="headerlink" title="print &lt;value&gt;"></a><code>print &lt;value&gt;</code></h5><p>输出，要注意不同格式的输出</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">"print"</span>:</span><br><span class="line">    next = oper_command.get(begin_index+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(next.getCommandType().equals(<span class="string">"word"</span>)) &#123;</span><br><span class="line">        <span class="comment">//print a word, eg. print "a --&gt; a</span></span><br><span class="line">        System.out.println(next.getCommandName().substring(<span class="number">1</span>));</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(next.getCommandType().equals(<span class="string">"list"</span>)) &#123;</span><br><span class="line">        System.out.println(next.getCommandName().trim().substring(<span class="number">1</span>, next.getCommandName().trim().length()-<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//print number or bool, etc, eg. print 1</span></span><br><span class="line">        System.out.println(next.getCommandName());</span><br><span class="line">    &#125;</span><br><span class="line">    oper_command.removeElementAt(begin_index+<span class="number">1</span>);</span><br><span class="line">    oper_command.removeElementAt(begin_index);</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<h5 id="read"><a href="#read" class="headerlink" title="read"></a><code>read</code></h5><p>返回从标准输入读取的数字或字</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">"read"</span>:</span><br><span class="line">    <span class="comment">//read in a number/word, classify it</span></span><br><span class="line">    <span class="keyword">if</span>(scan.hasNext()) &#123;</span><br><span class="line">        String input = scan.nextLine();</span><br><span class="line">        <span class="keyword">if</span>(isNumber(input)) &#123;</span><br><span class="line">            newCom = <span class="keyword">new</span> command(input.trim(), <span class="string">"number"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            newCom = <span class="keyword">new</span> command(<span class="string">'"'</span>+input.trim(), <span class="string">"word"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        oper_command.setElementAt(newCom, begin_index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<h5 id="readlist"><a href="#readlist" class="headerlink" title="readlist"></a><code>readlist</code></h5><p>读入单层的表</p>
<p>这里好像没做对，后续更新</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">"readlist"</span>:</span><br><span class="line">    <span class="comment">//read in a list (single layer, in one line)</span></span><br><span class="line">    <span class="keyword">if</span>(scan.hasNext()) &#123;</span><br><span class="line">        String input = scan.nextLine();</span><br><span class="line">        newCom =<span class="keyword">new</span> command(input.trim(), <span class="string">"list"</span>);</span><br><span class="line">        oper_command.setElementAt(newCom, begin_index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<h5 id="repeat-lt-number-gt-lt-list-gt"><a href="#repeat-lt-number-gt-lt-list-gt" class="headerlink" title="repeat &lt;number&gt; &lt;list&gt;"></a><code>repeat &lt;number&gt; &lt;list&gt;</code></h5><p>将<code>&lt;list&gt;</code>中的内容作为一个新的<code>commandStack</code>，进行循环操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">"repeat"</span>:</span><br><span class="line">    <span class="comment">//loop</span></span><br><span class="line">    next1 = oper_command.get(begin_index+<span class="number">1</span>);</span><br><span class="line">    next2 = oper_command.get(begin_index+<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">if</span>(!next1.getCommandType().equals(<span class="string">"number"</span>) || !next2.getCommandType().equals(<span class="string">"list"</span>))&#123;</span><br><span class="line">        System.out.println(<span class="string">"ERROR: repeat &lt;number&gt; &lt;list&gt;!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> repeatNum = (<span class="keyword">int</span>) next1.getNumValue(); <span class="comment">//loop times</span></span><br><span class="line">    <span class="keyword">int</span> repeatCnt = <span class="number">0</span>; <span class="comment">//the number of execution already take place</span></span><br><span class="line">    commandStack newComStack;</span><br><span class="line">    <span class="keyword">while</span>(repeatCnt != repeatNum) &#123;</span><br><span class="line">        <span class="comment">//create a new stack to store commands in the list, and run again</span></span><br><span class="line">        newComStack = <span class="keyword">new</span> commandStack(next2.getListString());</span><br><span class="line">        retstr = judge(newComStack, oper_var, <span class="number">0</span>);</span><br><span class="line">        repeatCnt++;</span><br><span class="line">    &#125;</span><br><span class="line">    oper_command.removeElementAt(begin_index+<span class="number">2</span>);</span><br><span class="line">    oper_command.removeElementAt(begin_index+<span class="number">1</span>);</span><br><span class="line">    oper_command.removeElementAt(begin_index);</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<h5 id="算数运算"><a href="#算数运算" class="headerlink" title="算数运算"></a>算数运算</h5><p>包括add、sub、mul、div、mod，以add为例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">"add"</span>:</span><br><span class="line">    next1 = oper_command.get(begin_index+<span class="number">1</span>);</span><br><span class="line">    next2 = oper_command.get(begin_index+<span class="number">2</span>);</span><br><span class="line">    newCom = <span class="keyword">new</span> command(next1.getNumValue()+next2.getNumValue()+<span class="string">""</span>, <span class="string">"number"</span>);</span><br><span class="line">    oper_command.setElementAt(newCom, begin_index);</span><br><span class="line">    oper_command.removeElementAt(begin_index+<span class="number">2</span>);</span><br><span class="line">    oper_command.removeElementAt(begin_index+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<h5 id="大小比较"><a href="#大小比较" class="headerlink" title="大小比较"></a>大小比较</h5><p>包括eq、gt、lt，以eq为例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">"eq"</span>:</span><br><span class="line">    next1 = oper_command.get(begin_index+<span class="number">1</span>);</span><br><span class="line">    next2 = oper_command.get(begin_index+<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">if</span>(next1.getCommandType().equals(<span class="string">"word"</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span>(next1.getCommandType().equals(<span class="string">"word"</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(oper_var.getNumValue(next1.getCommandName()) == oper_var.getNumValue(next2.getCommandName()))&#123;</span><br><span class="line">                newCom = <span class="keyword">new</span> command(<span class="string">"true"</span>, <span class="string">"bool"</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                newCom = <span class="keyword">new</span> command(<span class="string">"false"</span>, <span class="string">"bool"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(oper_var.getNumValue(next1.getCommandName()) == next2.getNumValue())&#123;</span><br><span class="line">                newCom = <span class="keyword">new</span> command(<span class="string">"true"</span>, <span class="string">"bool"</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                newCom = <span class="keyword">new</span> command(<span class="string">"false"</span>, <span class="string">"bool"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(next1.getCommandType().equals(<span class="string">"word"</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(next1.getNumValue() == oper_var.getNumValue(next2.getCommandName()))&#123;</span><br><span class="line">                newCom = <span class="keyword">new</span> command(<span class="string">"true"</span>, <span class="string">"bool"</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                newCom = <span class="keyword">new</span> command(<span class="string">"false"</span>, <span class="string">"bool"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(next1.getNumValue() == next2.getNumValue())&#123;</span><br><span class="line">                newCom = <span class="keyword">new</span> command(<span class="string">"true"</span>, <span class="string">"bool"</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                newCom = <span class="keyword">new</span> command(<span class="string">"false"</span>, <span class="string">"bool"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    oper_command.setElementAt(newCom, begin_index);</span><br><span class="line">    oper_command.removeElementAt(begin_index+<span class="number">2</span>);</span><br><span class="line">    oper_command.removeElementAt(begin_index+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<h5 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h5><p>包括and、or、not，以and为例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">"and"</span>:</span><br><span class="line">    next1 = oper_command.get(begin_index+<span class="number">1</span>);</span><br><span class="line">    next2 = oper_command.get(begin_index+<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">if</span>(next1.getBoolValue() &amp;&amp; next2.getBoolValue()) &#123;</span><br><span class="line">        newCom = <span class="keyword">new</span> command(<span class="string">"true"</span>, <span class="string">"bool"</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        newCom = <span class="keyword">new</span> command(<span class="string">"false"</span>, <span class="string">"bool"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    oper_command.setElementAt(newCom, begin_index);</span><br><span class="line">    oper_command.removeElementAt(begin_index+<span class="number">2</span>);</span><br><span class="line">    oper_command.removeElementAt(begin_index+<span class="number">1</span>);					</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<h5 id="if-lt-bool-gt-lt-list1-gt-lt-list2-gt"><a href="#if-lt-bool-gt-lt-list1-gt-lt-list2-gt" class="headerlink" title="if &lt;bool&gt; &lt;list1&gt; &lt;list2&gt;"></a><code>if &lt;bool&gt; &lt;list1&gt; &lt;list2&gt;</code></h5><p>根据条件是<code>true</code>或者<code>false</code>判断运行哪个<code>&lt;list&gt;</code>，将对应<code>&lt;list&gt;</code>中的操作作为一个新的<code>commandStack</code>进行运行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">"if"</span>:</span><br><span class="line">    next1 = oper_command.get(begin_index+<span class="number">1</span>);</span><br><span class="line">    command list1 = oper_command.get(begin_index+<span class="number">2</span>);</span><br><span class="line">    command list2 = oper_command.get(begin_index+<span class="number">3</span>);			</span><br><span class="line">    <span class="keyword">if</span>(next1.getCommandName().equals(<span class="string">"true"</span>)) &#123;</span><br><span class="line">        <span class="comment">//run the commands in list1</span></span><br><span class="line">        newComStack = <span class="keyword">new</span> commandStack(list1.getListString());</span><br><span class="line">        retstr = judge(newComStack, oper_var, <span class="number">0</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//run the commands in list2</span></span><br><span class="line">        newComStack = <span class="keyword">new</span> commandStack(list2.getListString());</span><br><span class="line">        retstr = judge(newComStack, oper_var, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    oper_command.removeElementAt(begin_index+<span class="number">3</span>);</span><br><span class="line">    oper_command.removeElementAt(begin_index+<span class="number">2</span>);</span><br><span class="line">    oper_command.removeElementAt(begin_index+<span class="number">1</span>);</span><br><span class="line">    oper_command.removeElementAt(begin_index);</span><br><span class="line">	<span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<h5 id="run-lt-list-gt"><a href="#run-lt-list-gt" class="headerlink" title="run &lt;list&gt;"></a><code>run &lt;list&gt;</code></h5><p>同<code>if</code>和<code>repeat</code>中的做法，将<code>&lt;list&gt;</code>视作新的<code>commandStack</code>进行运行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">"run"</span>:</span><br><span class="line">    next = oper_command.get(begin_index+<span class="number">1</span>);</span><br><span class="line">    newComStack = <span class="keyword">new</span> commandStack(next.getListString());</span><br><span class="line">    retstr = judge(newComStack, oper_var, <span class="number">0</span>);</span><br><span class="line">    oper_command.removeElementAt(begin_index+<span class="number">1</span>);</span><br><span class="line">    oper_command.removeElementAt(begin_index);</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<h5 id="判断-1"><a href="#判断-1" class="headerlink" title="判断"></a>判断</h5><p>包括<code>isnumber</code>, <code>isword</code>, <code>islist</code>, <code>isbool</code>, <code>isempty</code>，即判断下一个<code>command</code>的类别即可，以<code>isnumber</code>为例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">"isnumber"</span>:</span><br><span class="line">    next1 = oper_command.get(begin_index+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(next1.getCommandType().equals(<span class="string">"number"</span>))&#123;</span><br><span class="line">        result = <span class="string">"true"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        result = <span class="string">"false"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    newCom = <span class="keyword">new</span> command(result, <span class="string">"bool"</span>);</span><br><span class="line">    oper_command.setElementAt(newCom, begin_index);</span><br><span class="line">    oper_command.removeElementAt(begin_index+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<h5 id="字表合并"><a href="#字表合并" class="headerlink" title="字表合并"></a>字表合并</h5><p>包括<code>word</code>, <code>sentence</code>, <code>list</code>, <code>join</code>，将后面两个字/表合并为新的表，以<code>word</code>为例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">"word"</span>:</span><br><span class="line">    next1 = oper_command.get(begin_index+<span class="number">1</span>);</span><br><span class="line">    next2 = oper_command.get(begin_index+<span class="number">2</span>);</span><br><span class="line">    String newword;</span><br><span class="line">    <span class="keyword">if</span>(next2.getCommandType().equals(<span class="string">"word"</span>)) &#123;</span><br><span class="line">        newword = next1.getCommandName().substring(<span class="number">1</span>) + next2.getCommandName().substring(<span class="number">1</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        newword = next1.getCommandName().substring(<span class="number">1</span>) + next2.getCommandName();</span><br><span class="line">    &#125;</span><br><span class="line">    newCom = <span class="keyword">new</span> command(<span class="string">"\""</span> + newword);</span><br><span class="line">    oper_command.setElementAt(newCom, begin_index);</span><br><span class="line">    oper_command.removeElementAt(begin_index+<span class="number">2</span>);</span><br><span class="line">    oper_command.removeElementAt(begin_index+<span class="number">1</span>);				</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<h5 id="字表提取"><a href="#字表提取" class="headerlink" title="字表提取"></a>字表提取</h5><p><code>first</code>, <code>butfirst</code>, <code>last</code>, <code>butlast</code>，提取出对应位置的字/表，按照要求进行处理之后放回栈。以<code>first</code>和<code>butfirst</code>为例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">"first"</span>:</span><br><span class="line">    next = oper_command.get(begin_index+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(next.getCommandType().equals(<span class="string">"word"</span>)) &#123;</span><br><span class="line">        <span class="comment">//first "abc -&gt; a (word)</span></span><br><span class="line">        newCom = <span class="keyword">new</span> command(next.getCommandName().substring(<span class="number">0</span>, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(next.getCommandType().equals(<span class="string">"list"</span>))&#123;</span><br><span class="line">        <span class="comment">//first [a b c] -&gt; a (word)</span></span><br><span class="line">        newComStack = <span class="keyword">new</span> commandStack(next.getCommandName().trim().substring(<span class="number">1</span>, next.getCommandName().trim().length()-<span class="number">1</span>));</span><br><span class="line">        <span class="comment">//in the above example, a is recognized as an operator, not a word. but it should be a word</span></span><br><span class="line">        <span class="keyword">if</span>(newComStack.get(<span class="number">0</span>).getCommandType().equals(<span class="string">"operator"</span>)) &#123;</span><br><span class="line">            <span class="comment">//it should be a word</span></span><br><span class="line">            newCom = <span class="keyword">new</span> command(<span class="string">"\""</span> + newComStack.get(<span class="number">0</span>).getCommandName());</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//first [[a] b] -&gt; [a] (list)</span></span><br><span class="line">            newCom = newComStack.get(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//first "123 -&gt; 1 (word)</span></span><br><span class="line">        newCom = <span class="keyword">new</span> command(<span class="string">"\""</span> + next.getCommandName().substring(<span class="number">0</span>, <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    oper_command.setElementAt(newCom, begin_index);</span><br><span class="line">    oper_command.removeElementAt(begin_index+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">"butfirst"</span>:</span><br><span class="line">    next = oper_command.get(begin_index+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(next.getCommandType().equals(<span class="string">"word"</span>)) &#123;</span><br><span class="line">        newCom = <span class="keyword">new</span> command(<span class="string">"\""</span> + next.getCommandName().substring(<span class="number">2</span>, next.getCommandName().trim().length()));</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(next.getCommandType().equals(<span class="string">"list"</span>))&#123;</span><br><span class="line">        newComStack = <span class="keyword">new</span> commandStack(next.getCommandName().trim().substring(<span class="number">1</span>, next.getCommandName().trim().length()-<span class="number">1</span>));</span><br><span class="line">        newStr = <span class="string">""</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;newComStack.size(); i++) &#123;</span><br><span class="line">                newCom = newComStack.get(i);</span><br><span class="line">                newStr += newCom.getCommandName() + <span class="string">" "</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            newCom = <span class="keyword">new</span> command(<span class="string">"["</span> + newStr + <span class="string">"]"</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        newCom = <span class="keyword">new</span> command(<span class="string">"\""</span> + next.getCommandName().substring(<span class="number">1</span>, next.getCommandName().trim().length()));</span><br><span class="line">    &#125;</span><br><span class="line">    oper_command.setElementAt(newCom, begin_index);</span><br><span class="line">    oper_command.removeElementAt(begin_index+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<h5 id="save-lt-word-gt"><a href="#save-lt-word-gt" class="headerlink" title="save &lt;word&gt;"></a><code>save &lt;word&gt;</code></h5><p>用了取巧的方式，只保存当前空间的变量和函数，而不是将所有代码都保存下来。可能要改。</p>
<p>将变量和函数变成对应<code>make</code>格式的MUA语句进行输出和保存。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">"save"</span>:</span><br><span class="line">    next = oper_command.get(begin_index+<span class="number">1</span>);</span><br><span class="line">    File fout = <span class="keyword">new</span> File(next.getCommandName().substring(<span class="number">1</span>));</span><br><span class="line">    FileWriter fw = <span class="keyword">new</span> FileWriter(fout);</span><br><span class="line"></span><br><span class="line">    variable currentVar;</span><br><span class="line">    function currentFunc;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;oper_var.size(); i++) &#123;</span><br><span class="line">        currentVar = oper_var.get(i);</span><br><span class="line">        newStr = <span class="string">"make "</span> + currentVar.getName() + <span class="string">" "</span> + currentVar.getValue() + <span class="string">"\n"</span>;</span><br><span class="line">        fw.write(newStr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;func.size(); i++) &#123;</span><br><span class="line">        currentFunc = func.get(i);</span><br><span class="line">        newStr = <span class="string">"make "</span> + currentFunc.getName() + <span class="string">" [["</span> + currentFunc.getVarList() + <span class="string">"] ["</span> + currentFunc.getOperList() + <span class="string">"]]\n"</span>;</span><br><span class="line">        fw.write(newStr);</span><br><span class="line">    &#125;</span><br><span class="line">    fw.close();</span><br><span class="line">    oper_command.removeElementAt(begin_index+<span class="number">1</span>);</span><br><span class="line">    oper_command.removeElementAt(begin_index);</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<h5 id="load-lt-word-gt"><a href="#load-lt-word-gt" class="headerlink" title="load &lt;word&gt;"></a><code>load &lt;word&gt;</code></h5><p>读取对应文件，依次运行其中的语句</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">"load"</span>:</span><br><span class="line">    next = oper_command.get(begin_index+<span class="number">1</span>);</span><br><span class="line">    FileReader fr = <span class="keyword">new</span> FileReader(next.getCommandName().substring(<span class="number">1</span>));</span><br><span class="line">    BufferedReader br = <span class="keyword">new</span> BufferedReader(fr);</span><br><span class="line">    <span class="keyword">while</span>((newStr = br.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        newComStack = <span class="keyword">new</span> commandStack(newStr);</span><br><span class="line">        judge(newComStack, <span class="keyword">var</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    oper_command.removeElementAt(begin_index+<span class="number">1</span>);</span><br><span class="line">    oper_command.removeElementAt(begin_index);</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<h5 id="erall"><a href="#erall" class="headerlink" title="erall"></a><code>erall</code></h5><p>清空变量栈和函数栈</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">"erall"</span>:</span><br><span class="line">    <span class="keyword">while</span>(oper_var.size()!=<span class="number">0</span>) &#123;</span><br><span class="line">        oper_var.removeElementAt(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(func.size()!=<span class="number">0</span>) &#123;</span><br><span class="line">        func.removeElementAt(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    oper_command.removeElementAt(begin_index);</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<h5 id="poall"><a href="#poall" class="headerlink" title="poall"></a><code>poall</code></h5><p>列出变量栈和函数栈的全部内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">"poall"</span>:</span><br><span class="line">    System.out.print(<span class="string">"variables: "</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;oper_var.size(); i++) &#123;</span><br><span class="line">        System.out.print(oper_var.get(i).getName());</span><br><span class="line">        <span class="keyword">if</span>(i != oper_var.size()-<span class="number">1</span>) &#123;</span><br><span class="line">            System.out.print(<span class="string">", "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println();</span><br><span class="line">    System.out.print(<span class="string">"functions: "</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;func.size(); i++) &#123;</span><br><span class="line">        System.out.print(func.get(i).getName());</span><br><span class="line">        <span class="keyword">if</span>(i != func.size()-<span class="number">1</span>) &#123;</span><br><span class="line">            System.out.print(<span class="string">", "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println();</span><br><span class="line">    oper_command.removeElementAt(begin_index);</span><br><span class="line">    <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<hr>
<p>完整代码请见<a href="https://github.com/Iris-cyy/MUA-Interpreter/" target="_blank" rel="noopener">github</a>，欢迎star :)</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Projects/" rel="tag"># Projects</a>
          
            <a href="/tags/Java/" rel="tag"># Java</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/PAT/Advanced/2020-01-29/pat_1003/" rel="next" title="【PAT-Advanced】1003 Emergency">
                <i class="fa fa-chevron-left"></i> 【PAT-Advanced】1003 Emergency
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/Projects/2020-02-02/java_crawler/" rel="prev" title="Java Crawler">
                Java Crawler <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="Irisssy" />
            
              <p class="site-author-name" itemprop="name">Irisssy</p>
              <p class="site-description motion-element" itemprop="description">ZJU</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">51</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Iris-cyy" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:chen_yy@zju.edu.cn" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.facebook.com/irisssychen" target="_blank" title="Facebook">
                      
                        <i class="fa fa-fw fa-facebook-square"></i>Facebook</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://blog.csdn.net/Iris_cyy" target="_blank" title="CSDN">
                      
                        <i class="fa fa-fw fa-link"></i>CSDN</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#基本语法"><span class="nav-number">1.</span> <span class="nav-text">基本语法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本数据类型value"><span class="nav-number">1.1.</span> <span class="nav-text">基本数据类型value</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#名字name"><span class="nav-number">1.2.</span> <span class="nav-text">名字name</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基本操作operation"><span class="nav-number">1.3.</span> <span class="nav-text">基本操作operation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#函数定义和调用"><span class="nav-number">1.4.</span> <span class="nav-text">函数定义和调用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#定义"><span class="nav-number">1.4.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#调用"><span class="nav-number">1.4.2.</span> <span class="nav-text">调用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#本地变量"><span class="nav-number">1.4.3.</span> <span class="nav-text">本地变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#函数相关的操作"><span class="nav-number">1.4.4.</span> <span class="nav-text">函数相关的操作</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#表达式计算"><span class="nav-number">1.5.</span> <span class="nav-text">表达式计算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#判断"><span class="nav-number">1.6.</span> <span class="nav-text">判断</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数值计算"><span class="nav-number">1.7.</span> <span class="nav-text">数值计算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字表处理"><span class="nav-number">1.8.</span> <span class="nav-text">字表处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#其他操作"><span class="nav-number">1.9.</span> <span class="nav-text">其他操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#既有名字"><span class="nav-number">1.10.</span> <span class="nav-text">既有名字</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#具体实现"><span class="nav-number">2.</span> <span class="nav-text">具体实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#整体结构"><span class="nav-number">2.1.</span> <span class="nav-text">整体结构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#command"><span class="nav-number">2.1.1.</span> <span class="nav-text">command</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#commandStack"><span class="nav-number">2.1.2.</span> <span class="nav-text">commandStack</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#variable"><span class="nav-number">2.1.3.</span> <span class="nav-text">variable</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#varStack"><span class="nav-number">2.1.4.</span> <span class="nav-text">varStack</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#function"><span class="nav-number">2.1.5.</span> <span class="nav-text">function</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#funcStack"><span class="nav-number">2.1.6.</span> <span class="nav-text">funcStack</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#exprMember"><span class="nav-number">2.1.7.</span> <span class="nav-text">exprMember</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#expression"><span class="nav-number">2.1.8.</span> <span class="nav-text">expression</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#整体实现"><span class="nav-number">2.2.</span> <span class="nav-text">整体实现</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#预处理"><span class="nav-number">2.2.1.</span> <span class="nav-text">预处理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#读入MUA语句"><span class="nav-number">2.2.2.</span> <span class="nav-text">读入MUA语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#运行"><span class="nav-number">2.2.3.</span> <span class="nav-text">运行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#函数运行"><span class="nav-number">2.2.4.</span> <span class="nav-text">函数运行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#表达式运算"><span class="nav-number">2.2.5.</span> <span class="nav-text">表达式运算</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#基本操作"><span class="nav-number">2.2.6.</span> <span class="nav-text">基本操作</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#make-lt-name-gt-lt-value-gt-或make-lt-name-gt-lt-list1-gt-lt-list2-gt"><span class="nav-number">2.2.6.1.</span> <span class="nav-text">make &lt;name&gt; &lt;value&gt;或make &lt;name&gt; [&lt;list1&gt; &lt;list2&gt;]</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#thing-lt-name-gt"><span class="nav-number">2.2.6.2.</span> <span class="nav-text">thing &lt;name&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#erase-lt-name-gt"><span class="nav-number">2.2.6.3.</span> <span class="nav-text">erase &lt;name&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#isname-lt-word-gt"><span class="nav-number">2.2.6.4.</span> <span class="nav-text">isname &lt;word&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#print-lt-value-gt"><span class="nav-number">2.2.6.5.</span> <span class="nav-text">print &lt;value&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#read"><span class="nav-number">2.2.6.6.</span> <span class="nav-text">read</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#readlist"><span class="nav-number">2.2.6.7.</span> <span class="nav-text">readlist</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#repeat-lt-number-gt-lt-list-gt"><span class="nav-number">2.2.6.8.</span> <span class="nav-text">repeat &lt;number&gt; &lt;list&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#算数运算"><span class="nav-number">2.2.6.9.</span> <span class="nav-text">算数运算</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#大小比较"><span class="nav-number">2.2.6.10.</span> <span class="nav-text">大小比较</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#逻辑运算"><span class="nav-number">2.2.6.11.</span> <span class="nav-text">逻辑运算</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#if-lt-bool-gt-lt-list1-gt-lt-list2-gt"><span class="nav-number">2.2.6.12.</span> <span class="nav-text">if &lt;bool&gt; &lt;list1&gt; &lt;list2&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#run-lt-list-gt"><span class="nav-number">2.2.6.13.</span> <span class="nav-text">run &lt;list&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#判断-1"><span class="nav-number">2.2.6.14.</span> <span class="nav-text">判断</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#字表合并"><span class="nav-number">2.2.6.15.</span> <span class="nav-text">字表合并</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#字表提取"><span class="nav-number">2.2.6.16.</span> <span class="nav-text">字表提取</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#save-lt-word-gt"><span class="nav-number">2.2.6.17.</span> <span class="nav-text">save &lt;word&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#load-lt-word-gt"><span class="nav-number">2.2.6.18.</span> <span class="nav-text">load &lt;word&gt;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#erall"><span class="nav-number">2.2.6.19.</span> <span class="nav-text">erall</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#poall"><span class="nav-number">2.2.6.20.</span> <span class="nav-text">poall</span></a></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Irisssy</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'T8wx2t3wjTvICLSFOHMKGoCX-gzGzoHsz',
        appKey: 'V5WyXiF6o1Fz8ohjJ2dW4Ozd',
        placeholder: 'Just go go',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.4"></script>



  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("T8wx2t3wjTvICLSFOHMKGoCX-gzGzoHsz", "V5WyXiF6o1Fz8ohjJ2dW4Ozd");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>

<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>